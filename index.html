<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentum Dash</title>
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            /* From XML: */
            color: rgb(232, 230, 227);
            background-color: rgb(24, 26, 27);
            border-color: rgb(115, 107, 94);
            outline-color: rgb(232, 230, 227);
            opacity: 1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, rgb(20, 21, 22) 0%, rgb(34, 37, 38) 100%);
            color: rgb(212, 209, 203);
            min-height: 100vh;
            padding-top: 120px; /* Space for fixed focus bar */
        }

        /* Focus Bar - Fixed Top Section */
        .focus-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, rgb(32, 34, 36) 0%, rgb(23, 24, 25) 100%);
            border-bottom: 3px solid rgb(0, 73, 156);
            padding: 20px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            color: rgb(212, 209, 203);
        }

        .focus-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            color: rgb(212, 209, 203);
        }

        .focus-left {
            flex: 1;
            text-align: left;
            color: rgb(212, 209, 203);
        }

        .focus-center {
            flex: 1;
            text-align: center;
            color: rgb(212, 209, 203);
        }

        .focus-right {
            flex: 1;
            text-align: right;
            color: rgb(212, 209, 203);
        }

        /* Current / Next Activity */
        .current-activity {
            font-size: 1.4em;
            font-weight: 600;
            color: rgb(77, 173, 255);
            margin-bottom: 5px;
        }

        .next-activity {
            font-size: 0.9em;
            color: rgb(157, 148, 136);
        }

        /* Countdown Timer */
        .countdown-timer {
            font-size: 2em;
            font-weight: 700;
            color: rgb(26, 255, 148);
            font-family: 'Courier New', monospace;
            margin-bottom: 8px;
        }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            height: 6px;
            background: rgb(38, 42, 43);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, rgb(0, 74, 160), rgb(0, 204, 133));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* Clock and Date */
        .clock {
            font-size: 1.6em;
            font-weight: 600;
            color: rgb(232, 230, 227);
            font-family: 'Courier New', monospace;
        }

        .date {
            font-size: 0.9em;
            color: rgb(157, 148, 136);
            margin-top: 5px;
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            color: rgb(212, 209, 203);
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
            color: rgb(212, 209, 203);
        }

        .toggle-btn {
            background: linear-gradient(135deg, rgb(0, 74, 160), rgb(42, 98, 151));
            color: rgb(232, 230, 227);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 74, 160, 0.3);
        }

        .toggle-btn:hover {
            /* Retained original hover since no XML override was provided */
            background: linear-gradient(135deg, #357abd, #2a5f8f);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 158, 255, 0.4);
        }

        /* Daily Schedule - Horizontal Flow */
        .daily-schedule {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: flex-start;
        }

        .schedule-card {
            background: linear-gradient(135deg, rgb(38, 42, 43) 0%, rgb(32, 34, 36) 100%);
            border: 2px solid rgb(118, 109, 97);
            border-radius: 12px;
            padding: 16px;
            min-width: 280px;
            max-width: 350px;
            flex: 0 1 auto;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            color: rgb(212, 209, 203);
        }

        .schedule-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border-color: rgb(77, 173, 255);
        }

        .schedule-card.current {
            border-color: rgb(0, 179, 95);
            background: linear-gradient(135deg, rgb(21, 59, 46) 0%, rgb(36, 59, 36) 100%);
            box-shadow: 0 0 20px rgba(0, 204, 133, 0.3);
            color: rgb(212, 209, 203);
        }

        .schedule-card.current::before {
            content: "CURRENT";
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgb(0, 179, 95);
            color: #000;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: 700;
        }

        .card-time {
            font-size: 1.1em;
            font-weight: 600;
            color: rgb(77, 173, 255);
            margin-bottom: 8px;
        }

        .card-activity {
            font-size: 1em;
            font-weight: 500;
            margin-bottom: 8px;
            line-height: 1.4;
            color: rgb(212, 209, 203);
        }

        .card-duration {
            font-size: 0.9em;
            color: rgb(157, 148, 136);
            margin-bottom: 8px;
        }

        .card-notes {
            font-size: 0.8em;
            color: rgb(178, 172, 162);
            font-style: italic;
            border-top: 1px solid rgb(118, 109, 97);
            padding-top: 8px;
            margin-top: 8px;
        }

        /* Weekly Schedule */
        .weekly-schedule {
            display: none;
        }

        .weekly-schedule.active {
            display: block;
        }

        #dayTabs {
            color: rgb(212, 209, 203);
        }

        .day-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            color: rgb(212, 209, 203);
        }

        .day-tab {
            background: #333;
            color: #ccc;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .day-tab:hover {
            background: #444;
            color: #fff;
        }

        .day-tab.active {
            background: linear-gradient(135deg, #4a9eff, #357abd);
            color: white;
            box-shadow: 0 4px 15px rgba(74, 158, 255, 0.3);
        }

        .day-content {
            display: none;
        }

        .day-content.active {
            display: block;
        }

        .weekly-item {
            background: linear-gradient(135deg, rgb(38, 42, 43) 0%, rgb(32, 34, 36) 100%);
            border: 1px solid rgb(118, 109, 97);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            gap: 20px;
            align-items: center;
            transition: all 0.3s ease;
            color: rgb(212, 209, 203);
        }

        .weekly-item:hover {
            border-color: rgb(77, 173, 255);
            transform: translateX(5px);
        }

        .weekly-time {
            font-weight: 600;
            color: rgb(77, 173, 255);
            min-width: 100px;
        }

        .weekly-activity {
            flex: 1;
            font-weight: 500;
            color: rgb(212, 209, 203);
        }

        .weekly-duration {
            color: rgb(157, 148, 136);
            font-size: 0.9em;
            min-width: 80px;
            text-align: right;
        }

        .weekly-notes {
            color: rgb(178, 172, 162);
            font-size: 0.8em;
            font-style: italic;
            margin-top: 5px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .focus-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .focus-left, .focus-center, .focus-right {
                flex: none;
            }

            .countdown-timer {
                font-size: 1.5em;
            }

            .schedule-card {
                min-width: 250px;
                max-width: none;
                flex: 1 1 100%;
            }

            .day-tabs {
                justify-content: center;
            }

            body {
                padding-top: 180px;
            }
        }

        /* Loading Animation */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #888; /* No XML override provided */
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: linear-gradient(135deg, #2a2a2a 0%, #1e1e1e 100%);
            border: 2px solid #4a9eff;
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: scale(0.7);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal-content {
            transform: scale(1);
        }

        .modal-title {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #4a9eff; /* No XML override provided */
        }

        .modal-message {
            font-size: 1.1em;
            margin-bottom: 25px;
            line-height: 1.4;
            color: #e0e0e0; /* No XML override provided */
        }

        .modal-button {
            background: linear-gradient(135deg, #4a9eff, #357abd);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(74, 158, 255, 0.3);
            min-width: 100px;
        }

        .modal-button:hover {
            background: linear-gradient(135deg, #357abd, #2a5f8f);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 158, 255, 0.4);
        }

        .warning-modal .modal-content {
            border-color: #ffaa00; /* No XML override provided */
        }

        .warning-modal .modal-title {
            color: #ffaa00; /* No XML override provided */
        }

        .end-modal .modal-content {
            border-color: #00ff88; /* No XML override provided */
        }

        .end-modal .modal-title {
            color: #00ff88; /* No XML override provided */
        }

        /* Sound Indicator */
        .sound-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            background: #00ff88; /* No XML override provided */
            border-radius: 50%;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Utility Classes */
        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- Focus Bar - Fixed Top -->
    <div class="focus-bar">
        <div class="focus-content">
            <div class="focus-left">
                <div class="current-activity" id="currentActivity">Loading...</div>
                <div class="next-activity" id="nextActivity">Next: Loading...</div>
            </div>
            <div class="focus-center">
                <div class="countdown-timer" id="countdownTimer">--:--:--</div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>
            <div class="focus-right">
                <div class="clock" id="clock">--:--</div>
                <div class="date" id="date">LOADING...</div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Controls -->
        <div class="controls">
            <button class="toggle-btn" id="toggleBtn" onclick="toggleView()">View Full Week</button>
        </div>

        <!-- Daily Schedule View -->
        <div class="daily-schedule" id="dailySchedule">
            <div class="loading">Loading schedule...</div>
        </div>

        <!-- Weekly Schedule View -->
        <div class="weekly-schedule" id="weeklySchedule">
            <div class="day-tabs" id="dayTabs"></div>
            <div id="weeklyContent"></div>
        </div>
    </div>

    <script>
        // --- Momentum Dash - Schedule Data Handling and Notifications ---

        const hardcodedScheduleJSON = `{
  "monday": [
    { "startTime": "9:00 AM", "endTime": "10:00 AM", "activity": "Wake up, Breakfast & Quick Meal Prep / Plan Day", "duration": "1 hour", "notes": "" },
    { "startTime": "10:00 AM", "endTime": "11:30 AM", "activity": "Morning Fitness Training", "duration": "1 hr 30 mins", "notes": "" },
    { "startTime": "11:30 AM", "endTime": "12:00 PM", "activity": "Shower, Short Rest", "duration": "30 mins", "notes": "" },
    { "startTime": "12:00 PM", "endTime": "12:30 PM", "activity": "Focus A: Mental Math", "duration": "30 mins", "notes": "Rotation: Mental Math on Mon, Wed, Fri." },
    { "startTime": "12:30 PM", "endTime": "12:35 PM", "activity": "Break", "duration": "5 mins", "notes": "" },
    { "startTime": "12:35 PM", "endTime": "1:15 PM", "activity": "Focus B: Memory Training", "duration": "40 mins", "notes": "Rotation: Memory Training on Mon, Wed, Fri." },
    { "startTime": "1:15 PM", "endTime": "1:20 PM", "activity": "Break", "duration": "5 mins", "notes": "" },
    { "startTime": "1:20 PM", "endTime": "2:00 PM", "activity": "DS & Algo Coding Exercises", "duration": "40 mins", "notes": "" },
    { "startTime": "2:00 PM", "endTime": "3:25 PM", "activity": "Lunch & Unwind / Life Admin", "duration": "1 hr 25 mins", "notes": "" },
    { "startTime": "3:25 PM", "endTime": "4:25 PM", "activity": "Coding Design Patterns", "duration": "1 hour", "notes": "" },
    { "startTime": "4:25 PM", "endTime": "4:40 PM", "activity": "Transition to Work / Buffer", "duration": "15 mins", "notes": "" },
    { "startTime": "4:40 PM", "endTime": "11:30 PM", "activity": "Work", "duration": "6 hrs 50 mins", "notes": "" },
    { "startTime": "11:30 PM", "endTime": "12:00 AM", "activity": "Therapy with AI", "duration": "30 mins", "notes": "Rotation: Therapy with AI on Mon, Wed, Fri." },
    { "startTime": "12:00 AM onwards", "endTime": "", "activity": "Wind-down, Prepare for Sleep", "duration": "", "notes": "" }
  ],
  "tuesday": [
    { "startTime": "9:00 AM", "endTime": "10:00 AM", "activity": "Wake up, Breakfast & Quick Meal Prep / Plan Day", "duration": "1 hour", "notes": "" },
    { "startTime": "10:00 AM", "endTime": "11:30 AM", "activity": "Morning Fitness Training", "duration": "1 hr 30 mins", "notes": "" },
    { "startTime": "11:30 AM", "endTime": "12:00 PM", "activity": "Shower, Short Rest", "duration": "30 mins", "notes": "" },
    { "startTime": "12:00 PM", "endTime": "12:30 PM", "activity": "Focus A: Cognitive Apps", "duration": "30 mins", "notes": "Rotation: Cognitive Apps on Tue, Thu." },
    { "startTime": "12:30 PM", "endTime": "12:35 PM", "activity": "Break", "duration": "5 mins", "notes": "" },
    { "startTime": "12:35 PM", "endTime": "1:15 PM", "activity": "Focus B: Reading w/ Gemini", "duration": "40 mins", "notes": "Rotation: Reading w/ Gemini on Tue, Thu." },
    { "startTime": "1:15 PM", "endTime": "1:20 PM", "activity": "Break", "duration": "5 mins", "notes": "" },
    { "startTime": "1:20 PM", "endTime": "2:00 PM", "activity": "DS & Algo Coding Exercises", "duration": "40 mins", "notes": "" },
    { "startTime": "2:00 PM", "endTime": "3:25 PM", "activity": "Lunch & Unwind / Life Admin", "duration": "1 hr 25 mins", "notes": "" },
    { "startTime": "3:25 PM", "endTime": "4:25 PM", "activity": "Coding Design Patterns", "duration": "1 hour", "notes": "" },
    { "startTime": "4:25 PM", "endTime": "4:40 PM", "activity": "Transition to Work / Buffer", "duration": "15 mins", "notes": "" },
    { "startTime": "4:40 PM", "endTime": "11:30 PM", "activity": "Work", "duration": "6 hrs 50 mins", "notes": "" },
    { "startTime": "11:30 PM", "endTime": "12:00 AM", "activity": "Study Math and Accounting with AI", "duration": "30 mins", "notes": "Rotation: Study Math and Accounting with AI on Tue, Thu." },
    { "startTime": "12:00 AM onwards", "endTime": "", "activity": "Wind-down, Prepare for Sleep", "duration": "", "notes": "" }
  ],
  "wednesday": [
    { "startTime": "9:00 AM", "endTime": "10:00 AM", "activity": "Wake up, Breakfast & Quick Meal Prep / Plan Day", "duration": "1 hour", "notes": "" },
    { "startTime": "10:00 AM", "endTime": "11:30 AM", "activity": "Morning Fitness Training", "duration": "1 hr 30 mins", "notes": "" },
    { "startTime": "11:30 AM", "endTime": "12:00 PM", "activity": "Shower, Short Rest", "duration": "30 mins", "notes": "" },
    { "startTime": "12:00 PM", "endTime": "12:30 PM", "activity": "Focus A: Mental Math", "duration": "30 mins", "notes": "Rotation: Mental Math on Mon, Wed, Fri." },
    { "startTime": "12:30 PM", "endTime": "12:35 PM", "activity": "Break", "duration": "5 mins", "notes": "" },
    { "startTime": "12:35 PM", "endTime": "1:15 PM", "activity": "Focus B: Memory Training", "duration": "40 mins", "notes": "Rotation: Memory Training on Mon, Wed, Fri." },
    { "startTime": "1:15 PM", "endTime": "1:20 PM", "activity": "Break", "duration": "5 mins", "notes": "" },
    { "startTime": "1:20 PM", "endTime": "2:00 PM", "activity": "DS & Algo Coding Exercises", "duration": "40 mins", "notes": "" },
    { "startTime": "2:00 PM", "endTime": "3:25 PM", "activity": "Lunch & Unwind / Life Admin", "duration": "1 hr 25 mins", "notes": "" },
    { "startTime": "3:25 PM", "endTime": "4:25 PM", "activity": "Coding Design Patterns", "duration": "1 hour", "notes": "" },
    { "startTime": "4:25 PM", "endTime": "4:40 PM", "activity": "Transition to Work / Buffer", "duration": "15 mins", "notes": "" },
    { "startTime": "4:40 PM", "endTime": "11:30 PM", "activity": "Work", "duration": "6 hrs 50 mins", "notes": "" },
    { "startTime": "11:30 PM", "endTime": "12:00 AM", "activity": "Therapy with AI", "duration": "30 mins", "notes": "Rotation: Therapy with AI on Mon, Wed, Fri." },
    { "startTime": "12:00 AM onwards", "endTime": "", "activity": "Wind-down, Prepare for Sleep", "duration": "", "notes": "" }
  ],
  "thursday": [
    { "startTime": "9:00 AM", "endTime": "10:00 AM", "activity": "Wake up, Breakfast & Quick Meal Prep / Plan Day", "duration": "1 hour", "notes": "" },
    { "startTime": "10:00 AM", "endTime": "11:30 AM", "activity": "Morning Fitness Training", "duration": "1 hr 30 mins", "notes": "" },
    { "startTime": "11:30 AM", "endTime": "12:00 PM", "activity": "Shower, Short Rest", "duration": "30 mins", "notes": "" },
    { "startTime": "12:00 PM", "endTime": "12:30 PM", "activity": "Focus A: Cognitive Apps", "duration": "30 mins", "notes": "Rotation: Cognitive Apps on Tue, Thu." },
    { "startTime": "12:30 PM", "endTime": "12:35 PM", "activity": "Break", "duration": "5 mins", "notes": "" },
    { "startTime": "12:35 PM", "endTime": "1:15 PM", "activity": "Focus B: Reading w/ Gemini", "duration": "40 mins", "notes": "Rotation: Reading w/ Gemini on Tue, Thu." },
    { "startTime": "1:15 PM", "endTime": "1:20 PM", "activity": "Break", "duration": "5 mins", "notes": "" },
    { "startTime": "1:20 PM", "endTime": "2:00 PM", "activity": "DS & Algo Coding Exercises", "duration": "40 mins", "notes": "" },
    { "startTime": "2:00 PM", "endTime": "3:25 PM", "activity": "Lunch & Unwind / Life Admin", "duration": "1 hr 25 mins", "notes": "" },
    { "startTime": "3:25 PM", "endTime": "4:25 PM", "activity": "Coding Design Patterns", "duration": "1 hour", "notes": "" },
    { "startTime": "4:25 PM", "endTime": "4:40 PM", "activity": "Transition to Work / Buffer", "duration": "15 mins", "notes": "" },
    { "startTime": "4:40 PM", "endTime": "11:30 PM", "activity": "Work", "duration": "6 hrs 50 mins", "notes": "" },
    { "startTime": "11:30 PM", "endTime": "12:00 AM", "activity": "Study Math and Accounting with AI", "duration": "30 mins", "notes": "Rotation: Study Math and Accounting with AI on Tue, Thu." },
    { "startTime": "12:00 AM onwards", "endTime": "", "activity": "Wind-down, Prepare for Sleep", "duration": "", "notes": "" }
  ],
  "friday": [
    { "startTime": "9:00 AM", "endTime": "10:00 AM", "activity": "Wake up, Breakfast & Quick Meal Prep / Plan Day", "duration": "1 hour", "notes": "" },
    { "startTime": "10:00 AM", "endTime": "11:30 AM", "activity": "Morning Fitness Training", "duration": "1 hr 30 mins", "notes": "" },
    { "startTime": "11:30 AM", "endTime": "12:00 PM", "activity": "Shower, Short Rest", "duration": "30 mins", "notes": "" },
    { "startTime": "12:00 PM", "endTime": "12:30 PM", "activity": "Focus A: Mental Math", "duration": "30 mins", "notes": "Rotation: Mental Math on Mon, Wed, Fri." },
    { "startTime": "12:30 PM", "endTime": "12:35 PM", "activity": "Break", "duration": "5 mins", "notes": "" },
    { "startTime": "12:35 PM", "endTime": "1:15 PM", "activity": "Focus B: Memory Training", "duration": "40 mins", "notes": "Rotation: Memory Training on Mon, Wed, Fri." },
    { "startTime": "1:15 PM", "endTime": "1:20 PM", "activity": "Break", "duration": "5 mins", "notes": "" },
    { "startTime": "1:20 PM", "endTime": "2:00 PM", "activity": "DS & Algo Coding Exercises", "duration": "40 mins", "notes": "" },
    { "startTime": "2:00 PM", "endTime": "3:25 PM", "activity": "Lunch & Unwind / Life Admin", "duration": "1 hr 25 mins", "notes": "" },
    { "startTime": "3:25 PM", "endTime": "4:25 PM", "activity": "Coding Design Patterns", "duration": "1 hour", "notes": "" },
    { "startTime": "4:25 PM", "endTime": "4:40 PM", "activity": "Transition to Work / Buffer", "duration": "15 mins", "notes": "" },
    { "startTime": "4:40 PM", "endTime": "11:30 PM", "activity": "Work", "duration": "6 hrs 50 mins", "notes": "" },
    { "startTime": "11:30 PM", "endTime": "12:00 AM", "activity": "Therapy with AI", "duration": "30 mins", "notes": "Rotation: Therapy with AI on Mon, Wed, Fri." },
    { "startTime": "12:00 AM onwards", "endTime": "", "activity": "Wind-down, Prepare for Sleep", "duration": "", "notes": "" }
  ],
  "saturday": [
    { "startTime": "9:00 AM", "endTime": "9:45 AM", "activity": "Wake up, Quick Breakfast & Sat Meal Prep / Plan Day", "duration": "45 mins", "notes": "" },
    { "startTime": "9:45 AM", "endTime": "10:40 AM", "activity": "Morning Fitness Training", "duration": "55 mins", "notes": "Workout extended." },
    { "startTime": "10:40 AM", "endTime": "11:00 AM", "activity": "Shower, Short Rest", "duration": "20 mins", "notes": "Shower/rest time reduced." },
    { "startTime": "11:00 AM", "endTime": "11:30 AM", "activity": "Focused Cognitive Slot", "duration": "30 mins", "notes": "Weekly review, specific problem, or planning." },
    { "startTime": "11:30 AM", "endTime": "12:00 PM", "activity": "Lunch", "duration": "30 mins", "notes": "" },
    { "startTime": "12:00 PM", "endTime": "4:00 PM", "activity": "Work", "duration": "4 hours", "notes": "" },
    { "startTime": "After 4:00 PM", "endTime": "", "activity": "Free Time / Rest / Social Activities", "duration": "", "notes": "Structured day complete." }
  ],
  "sunday": [
    { "startTime": "All Day", "endTime": "", "activity": "Rest & Recharge", "duration": "", "notes": "Enjoy your free day!" }
  ]
}`;

        // Global variables
        let parsedSchedule = {};
        let currentView = 'daily';
        let currentDay = '';
        
        // Utility: Play a short beep via Web Audio API
        function playBeep() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = ctx.createOscillator();
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(440, ctx.currentTime);
                oscillator.connect(ctx.destination);
                oscillator.start();
                setTimeout(() => oscillator.stop(), 500);
            } catch (e) {
                console.error('Web Audio API not supported:', e);
            }
        }

        function playPreEndSound() {
            const audio = document.getElementById('preEndAudio');
            if (audio) {
                audio.currentTime = 0;
                audio.play().catch(e => console.warn("Audio play blocked:", e));
            }
        }

        function playEndSound() {
            const audio = document.getElementById('endAudio');
            if (audio) {
                audio.currentTime = 0;
                audio.play().catch(e => console.warn("Audio play blocked:", e));
            }
        }

        // Request Notification permission if needed
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission !== 'granted') {
                Notification.requestPermission();
            }
        }

        // V1 Implementation: Load schedule data from hardcoded JSON,
        // and initialize alert flags on each task
        async function loadScheduleData() {
            try {
                parsedSchedule = JSON.parse(hardcodedScheduleJSON);
                // For each day and each task, add flags:
                for (const day of Object.keys(parsedSchedule)) {
                    parsedSchedule[day].forEach(task => {
                        task.fiveMinuteAlertFired = false;
                        task.endAlertFired = false;
                    });
                }
                return parsedSchedule;
            } catch (error) {
                console.error('Error parsing schedule data:', error);
                return {};
            }
        }

        // Utility: Get current weekday string
        function getCurrentDay() {
            const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            return days[new Date().getDay()];
        }

        // Utility: Format a Date() as "HH:MM" (24-hour)
        function formatTime(date) {
            return date.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });
        }

        // Utility: Format a Date() as "DAY, MON DD"
        function formatDate(date) {
            const days = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
            const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
            return `${days[date.getDay()]}, ${months[date.getMonth()]} ${date.getDate()}`;
        }

        // Parse a time string like "9:00 AM" into a Date() object set to today at that hour/minute.
        // Returns null if timeStr is blank, contains "onwards", "All Day", or "After".
        function parseTime(timeStr) {
            if (!timeStr || timeStr.includes('onwards') || timeStr.includes('All Day') || timeStr.includes('After')) {
                return null;
            }
            const time = timeStr.toLowerCase().replace(/\s+/g, '');
            let hours, minutes;

            const isPM = time.includes('pm');
            const cleanTime = time.replace(/[ap]m/, '');

            if (cleanTime.includes(':')) {
                [hours, minutes] = cleanTime.split(':').map(Number);
            } else {
                hours = parseInt(cleanTime);
                minutes = 0;
            }

            if (isPM && hours !== 12) hours += 12;
            if (!isPM && hours === 12) hours = 0;

            const date = new Date();
            date.setHours(hours, minutes, 0, 0);
            return date;
        }

        // Determine which task is current and which is next. Return references to the original task objects.
        function getCurrentAndNextTask() {
            const today = getCurrentDay();
            const todaySchedule = parsedSchedule[today] || [];
            const now = new Date();

            let current = null;
            let next = null;

            for (let i = 0; i < todaySchedule.length; i++) {
                const taskObj = todaySchedule[i];
                const startTime = parseTime(taskObj.startTime);
                const endTime = parseTime(taskObj.endTime);

                if (startTime && endTime) {
                    if (now >= startTime && now < endTime) {
                        current = { task: taskObj, index: i };
                        if (i + 1 < todaySchedule.length) {
                            next = { task: todaySchedule[i + 1], index: i + 1 };
                        }
                        break;
                    } else if (startTime > now && !current) {
                        next = { task: taskObj, index: i };
                        break;
                    }
                }
            }
            return { current, next };
        }

        // Calculate countdown text and total seconds until endTime
        function calculateCountdown(endTime) {
            if (!endTime) return { display: 'No Timer', seconds: 0 };

            const end = parseTime(endTime);
            if (!end) return { display: 'No Timer', seconds: 0 };

            const now = new Date();
            const diff = end - now;

            if (diff <= 0) return { display: '00:00:00', seconds: 0 };

            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            return {
                display: `${hours.toString().padStart(2, '0')}:${minutes
                    .toString()
                    .padStart(2, '0')}:${seconds.toString().padStart(2, '0')} REMAINING`,
                seconds: Math.floor(diff / 1000)
            };
        }

        // Calculate progress percentage between startTime and endTime
        function calculateProgress(startTime, endTime) {
            if (!startTime || !endTime) return 0;

            const start = parseTime(startTime);
            const end = parseTime(endTime);
            const now = new Date();

            if (!start || !end || now < start || now > end) return 0;

            const total = end - start;
            const elapsed = now - start;

            return (elapsed / total) * 100;
        }

        // Update the clock, focus bar text, progress bar, and fire notifications if needed
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = formatTime(now);
            document.getElementById('date').textContent = formatDate(now);

            const { current, next } = getCurrentAndNextTask();

            if (current) {
                const ct = current.task;
                const countdown = calculateCountdown(ct.endTime);

                document.getElementById('currentActivity').textContent = ct.activity;
                document.getElementById('countdownTimer').textContent = countdown.display;

                const progress = calculateProgress(ct.startTime, ct.endTime);
                document.getElementById('progressBar').style.width = `${progress}%`;

                // Fire five-minute warning when exactly 300 seconds remain
                if (
                    countdown.seconds === 300 &&
                    !ct.fiveMinuteAlertFired
                ) {
                    ct.fiveMinuteAlertFired = true;
                    // Play a beep and show notification if permitted
                    playPreEndSound();
                    if (Notification.permission === 'granted') {
                        new Notification(`5 minutes left for "${ct.activity}"`);
                    }
                }

                // Fire end-of-task alert when zero or negative seconds remain (only once)
                if (
                    countdown.seconds <= 0 &&
                    !ct.endAlertFired
                ) {
                    ct.endAlertFired = true;
                    playEndSound();
                    if (Notification.permission === 'granted') {
                        new Notification(`"${ct.activity}" has ended.`);
                    }
                }
            } else {
                document.getElementById('currentActivity').textContent = 'No active task';
                document.getElementById('countdownTimer').textContent = '--:--:--';
                document.getElementById('progressBar').style.width = '0%';
            }

            if (next) {
                document.getElementById('nextActivity').textContent = `Next: ${next.task.activity}`;
            } else {
                document.getElementById('nextActivity').textContent = 'Next: Nothing scheduled';
            }

            // Update highlighting in daily view
            if (currentView === 'daily') {
                updateCurrentTaskHighlight(current);
            }
        }

        // Highlight the current task card in daily view
        function updateCurrentTaskHighlight(currentTask) {
            const cards = document.querySelectorAll('.schedule-card');
            cards.forEach((card, index) => {
                card.classList.remove('current');
                if (currentTask && index === currentTask.index) {
                    card.classList.add('current');
                }
            });
        }

        // Render daily schedule cards for the given day (or today if none specified)
        function renderDailySchedule(day = null) {
            const targetDay = day || getCurrentDay();
            const schedule = parsedSchedule[targetDay] || [];
            const container = document.getElementById('dailySchedule');

            container.innerHTML = '';

            schedule.forEach((task, index) => {
                const card = document.createElement('div');
                card.className = 'schedule-card fade-in';

                card.innerHTML = `
                    <div class="card-time">${task.startTime}${task.endTime ? ` - ${task.endTime}` : ''}</div>
                    <div class="card-activity">${task.activity}</div>
                    <div class="card-duration">${task.duration}</div>
                    ${task.notes ? `<div class="card-notes">${task.notes}</div>` : ''}
                `;

                container.appendChild(card);
            });
        }

        // Render the full weekly schedule with tabs
        function renderWeeklySchedule() {
            const container = document.getElementById('weeklySchedule');
            const tabsContainer = document.getElementById('dayTabs');
            const contentContainer = document.getElementById('weeklyContent');

            // Create day tabs
            tabsContainer.innerHTML = '';
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            const dayLabels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];

            days.forEach((day, index) => {
                const tab = document.createElement('button');
                tab.className = 'day-tab';
                tab.textContent = dayLabels[index];
                tab.onclick = (e) => showDay(day, e);

                if (index === 0) tab.classList.add('active');
                tabsContainer.appendChild(tab);
            });

            // Create day content containers
            contentContainer.innerHTML = '';
            days.forEach((day, index) => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day-content';
                dayDiv.id = `day-${day}`;

                if (index === 0) dayDiv.classList.add('active');

                const schedule = parsedSchedule[day] || [];
                schedule.forEach(task => {
                    const item = document.createElement('div');
                    item.className = 'weekly-item fade-in';

                    item.innerHTML = `
                        <div class="weekly-time">${task.startTime}</div>
                        <div class="weekly-activity">
                            ${task.activity}
                            ${task.notes ? `<div class="weekly-notes">${task.notes}</div>` : ''}
                        </div>
                        <div class="weekly-duration">${task.duration}</div>
                    `;

                    dayDiv.appendChild(item);
                });

                contentContainer.appendChild(dayDiv);
            });
        }

        // Switch between daily and weekly views
        function toggleView() {
            const dailySchedule = document.getElementById('dailySchedule');
            const weeklySchedule = document.getElementById('weeklySchedule');
            const toggleBtn = document.getElementById('toggleBtn');

            if (currentView === 'daily') {
                dailySchedule.style.display = 'none';
                weeklySchedule.classList.add('active');
                toggleBtn.textContent = 'View Today';
                currentView = 'weekly';
                renderWeeklySchedule();
            } else {
                dailySchedule.style.display = 'flex';
                weeklySchedule.classList.remove('active');
                toggleBtn.textContent = 'View Full Week';
                currentView = 'daily';
                renderDailySchedule();
            }
        }

        // Activate a specific day tab in weekly view
        function showDay(day, event) {
            document.querySelectorAll('.day-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            document.querySelectorAll('.day-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`day-${day}`).classList.add('active');
        }

        // Initialize application
        async function init() {
            try {
                // Request notification permission
                requestNotificationPermission();

                await loadScheduleData();
                currentDay = getCurrentDay();

                // Initial render
                renderDailySchedule();

                // Start clock updates
                updateClock();
                setInterval(updateClock, 1000);
            } catch (error) {
                console.error('Error initializing application:', error);
                document.getElementById('dailySchedule').innerHTML = '<div class="loading">Error loading schedule data</div>';
            }
        }

        // Start the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
    <audio id="preEndAudio" src="sounds/pre_end_task_sound.mp3"></audio>
    <audio id="endAudio" src="sounds/end_task_sound.mp3"></audio>
</body>
</html>
